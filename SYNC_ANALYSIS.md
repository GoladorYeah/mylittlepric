# –ê–Ω–∞–ª–∏–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏

## –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ localStorage (–ù–ï —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏):
1. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** (`auth-storage`):
   - ‚úÖ user, accessToken, refreshToken, tokenExpiresAt, isAuthenticated
   - **–°—Ç–∞—Ç—É—Å**: –ü—Ä–∞–≤–∏–ª—å–Ω–æ - —Ç–æ–∫–µ–Ω—ã —É–Ω–∏–∫–∞–ª—å–Ω—ã –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

2. **–ß–∞—Ç** (`chat-storage`):
   - ‚ùå **searchHistory** - –¥—É–±–ª–∏—Ä—É–µ—Ç —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
   - ‚úÖ messages, sessionId - —Ç–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è
   - ‚úÖ currentCategory, searchInProgress - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∏—Å–∫–∞
   - ‚úÖ savedSearch - –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ–∏—Å–∫ –ø–µ—Ä–µ–¥ "New Search"
   - ‚úÖ country, language, currency - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–∫–∞–ª–∏
   - ‚ö†Ô∏è isSidebarOpen - UI preference (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–º)

### –ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è):
1. **Search History** (Redis + –≤–æ–∑–º–æ–∂–Ω–æ PostgreSQL):
   - API: `/api/search-history`
   - –î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è authenticated –∏ anonymous users
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/history`

2. **Session Messages** (Redis):
   - API: `/api/chat/messages?session_id=...`
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é
   - –ü—Ä–∏–≤—è–∑–∞–Ω–æ –∫ session_id

---

## –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 1: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ searchHistory
**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- `store.searchHistory` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/history` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `SearchHistoryAPI.getSearchHistory()`
- –õ–æ–∫–∞–ª—å–Ω—ã–π `searchHistory` –ù–ò–ì–î–ï –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ó–∞–Ω–∏–º–∞–µ—Ç –º–µ—Å—Ç–æ –≤ localStorage
- –ù–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
- –ú–æ–∂–µ—Ç —É—Å—Ç–∞—Ä–µ—Ç—å –∏ –≤—ã–∑–≤–∞—Ç—å –ø—É—Ç–∞–Ω–∏—Ü—É

**–†–µ—à–µ–Ω–∏–µ:**
- –£–¥–∞–ª–∏—Ç—å `searchHistory` –∏–∑ `partialize` –≤ store.ts
- –£–¥–∞–ª–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã `addSearchToHistory`, `clearSearchHistory`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–Ω—ã–π API

---

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ 2: –¢–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è
**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç —á–∞—Ç –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ ‚Üí sessionId —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage
- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω ‚Üí –≤–∏–¥–∏—Ç –î–†–£–ì–£–Æ —Å–µ—Å—Å–∏—é –∏–ª–∏ –ø—É—Å—Ç–æ–π —á–∞—Ç

**–°—Ü–µ–Ω–∞—Ä–∏–∏:**
1. **–ù–∞—á–∞–ª –Ω–∞ –ü–ö, –ø—Ä–æ–¥–æ–ª–∂–∏–ª –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ:**
   - –ü—Ä–æ–±–ª–µ–º–∞: –ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ –Ω–æ–≤–∞—è –ø—É—Å—Ç–∞—è —Å–µ—Å—Å–∏—è
   - –û–∂–∏–¥–∞–Ω–∏–µ: –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ç–æ—Ç –∂–µ —á–∞—Ç

2. **–û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞ 2 —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö:**
   - –ü—Ä–æ–±–ª–µ–º–∞: –†–∞–∑–Ω—ã–µ session_id, —Ä–∞–∑–Ω—ã–µ —á–∞—Ç—ã
   - –û–∂–∏–¥–∞–Ω–∏–µ: –ó–∞–≤–∏—Å–∏—Ç –æ—Ç UX —Ä–µ—à–µ–Ω–∏—è

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:**

**–í–∞—Ä–∏–∞–Ω—Ç A: –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)**
- –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –∞–∫—Ç–∏–≤–Ω—É—é —Å–µ—Å—Å–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è (–º–µ–Ω–µ–µ 24—á) ‚Üí –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å
- –î–æ–±–∞–≤–∏—Ç—å API endpoint: `/api/sessions/active` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é —Å–µ—Å—Å–∏—é

**–í–∞—Ä–∏–∞–Ω—Ç B: –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π**
- –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏
- –î–∞—Ç—å –≤—ã–±—Ä–∞—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é
- –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–π UX

**–í–∞—Ä–∏–∞–Ω—Ç C: –û–¥–∏–Ω session_id –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π)**
- –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = –æ–¥–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è
- –ü—Ä–∏ –≤—Ö–æ–¥–µ —Å –¥—Ä—É–≥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è —Ç–∞ –∂–µ —Å–µ—Å—Å–∏—è
- –ü—Ä–æ—â–µ –≤—Å–µ–≥–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å

---

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (country, currency) –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è
**–í–æ–ø—Ä–æ—Å:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –†–æ—Å—Å–∏–∏ —Å —Ä—É–±–ª—è–º–∏ –Ω–∞ –ü–ö
- –ü–æ–µ—Ö–∞–ª –≤ –¢—É—Ä—Ü–∏—é, –æ—Ç–∫—Ä—ã–ª —Ç–µ–ª–µ—Ñ–æ–Ω
- –ö–∞–∫—É—é –≤–∞–ª—é—Ç—É –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å?

**–†–µ—à–µ–Ω–∏–µ:**
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–∫–∞–ª–∏ (country, currency, language) –æ—Å—Ç–∞–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∫ "–ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤—Ä—É—á–Ω—É—é

---

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 4: –ù–µ—Ç –æ—á–∏—Å—Ç–∫–∏ –ø—Ä–∏ logout
**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- –ü—Ä–∏ logout –æ—á–∏—â–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `auth-storage`
- `chat-storage` –æ—Å—Ç–∞–µ—Ç—Å—è (messages, sessionId, etc.)

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –î—Ä—É–≥–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ —Ç–æ–º –∂–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ —É–≤–∏–¥–∏—Ç —á—É–∂–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –£—Ç–µ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–∏ logout –æ—á–∏—â–∞—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ —á–∞—Ç–∞
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–µ—Å—Å–∏—é –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è?"

---

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (–Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å):

1. **–£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–π searchHistory –∏–∑ localStorage**
   - –§–∞–π–ª: `frontend/src/shared/lib/store.ts`
   - –£–±—Ä–∞—Ç—å –∏–∑ partialize
   - –£–±—Ä–∞—Ç—å –º–µ—Ç–æ–¥—ã addSearchToHistory, clearSearchHistory

2. **–û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ logout**
   - –§–∞–π–ª: `frontend/src/features/auth/*`
   - –ü—Ä–∏ logout –≤—ã–∑—ã–≤–∞—Ç—å `useChatStore.getState().clearMessages()`
   - –û—á–∏—â–∞—Ç—å localStorage chat-storage

3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏**
   - Backend: –î–æ–±–∞–≤–∏—Ç—å endpoint `/api/sessions/active`
   - Frontend: –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é —Å–µ—Å—Å–∏—é —Å —Å–µ—Ä–≤–µ—Ä–∞
   - –ü—Ä–µ–¥–ª–∞–≥–∞—Ç—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–ª–∏ –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é

### üü° –í–∞–∂–Ω—ã–µ (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ):

4. **–•—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ**
   - Endpoint: `/api/user/preferences`
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è country, currency, language
   - –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å–µ—Å—Å–∏–π**
   - –ï—Å–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ session_id –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç localStorage
   - –°–ø—Ä–æ—Å–∏—Ç—å: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å–µ—Å—Å–∏—é –∏–ª–∏ –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é?"

### üü¢ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:

6. **WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 2 —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
   - –£–≤–µ–¥–æ–º–∏—Ç—å –æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ —Å–µ—Å—Å–∏–π

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ—Å—Ç—å

### Must have (—Å–µ–π—á–∞—Å):
- ‚úÖ –£–¥–∞–ª–∏—Ç—å searchHistory –∏–∑ localStorage
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ logout

### Should have (—Å–∫–æ—Ä–æ):
- ‚è≥ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏
- ‚è≥ API –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏

### Nice to have (–ø–æ–∑–∂–µ):
- üí° –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- üí° –°–ø–∏—Å–æ–∫ —Å–µ—Å—Å–∏–π
- üí° Real-time sync —á–µ—Ä–µ–∑ WebSocket

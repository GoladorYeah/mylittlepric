<app-header />

<main class="min-h-screen w-full bg-gradient-to-br from-background via-background to-background/95">
  <div class="w-full max-w-4xl mx-auto px-4 pt-8 pb-36">
    <!-- Chat messages area -->
    <div #messagesContainer>
      @if (!chatStore.hasMessages()) {
        <!-- Empty State -->
        <div class="flex flex-col items-center justify-center min-h-[60vh] text-center space-y-6 animate-fade-in">
          <div class="w-20 h-20 rounded-full bg-primary/10 flex items-center justify-center">
            <mat-icon class="text-primary" style="font-size: 48px; width: 48px; height: 48px;">chat</mat-icon>
          </div>
          <div class="space-y-2">
            <h2 class="text-3xl font-bold text-foreground">Welcome to MyLittlePrice!</h2>
            <p class="text-muted-foreground text-lg max-w-md">
              Ask me anything about products you're looking for, and I'll help you find the best deals.
            </p>
          </div>
          <div class="space-y-3 w-full max-w-md">
            <p class="text-sm font-medium text-foreground">Try asking:</p>
            <div class="flex flex-col gap-2">
              <button
                mat-stroked-button
                class="text-left hover:bg-accent transition-colors"
                (click)="messageInput.set('I need a new laptop for programming')"
              >
                "I need a new laptop for programming"
              </button>
              <button
                mat-stroked-button
                class="text-left hover:bg-accent transition-colors"
                (click)="messageInput.set('Show me wireless headphones under $100')"
              >
                "Show me wireless headphones under $100"
              </button>
              <button
                mat-stroked-button
                class="text-left hover:bg-accent transition-colors"
                (click)="messageInput.set('Looking for a gaming mouse')"
              >
                "Looking for a gaming mouse"
              </button>
            </div>
          </div>
        </div>
      } @else {
        <div class="space-y-6">
          @for (message of chatStore.messages(); track message.id) {
            <app-chat-message
              [message]="message"
              [onQuickReply]="handleQuickReply.bind(this)"
            />
          }

          <!-- Loading indicator -->
          @if (chatStore.isLoading()) {
            <div class="flex items-center gap-2 text-muted-foreground">
              <div class="flex gap-1">
                <span class="loading-dot w-2 h-2 rounded-full bg-primary"></span>
                <span class="loading-dot w-2 h-2 rounded-full bg-primary"></span>
                <span class="loading-dot w-2 h-2 rounded-full bg-primary"></span>
              </div>
              <span class="text-sm">Thinking...</span>
            </div>
          }
        </div>
      }
    </div>
  </div>

  <!-- Fixed input field - always visible at bottom -->
  <div class="fixed bottom-0 left-0 right-0 bg-background z-30">
    <div class="w-full max-w-4xl mx-auto px-4 py-4 pb-8">
      <div class="flex items-center gap-2 px-4 py-2 rounded-xl bg-secondary border border-border focus-within:border-primary transition-colors">
        @if (chatStore.hasMessages()) {
          <button
            mat-icon-button
            (click)="startNewChat()"
            title="Start new chat"
            class="flex-shrink-0"
          >
            <mat-icon>add</mat-icon>
          </button>
        }

        <input
          type="text"
          [(ngModel)]="messageInput"
          (keydown.enter)="sendMessage()"
          [placeholder]="wsService.isConnected() ? 'Type your message...' : 'Connecting...'"
          [disabled]="chatStore.isLoading() || !wsService.isConnected()"
          class="flex-1 px-2 py-3 bg-transparent focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed"
        />

        <button
          mat-flat-button
          color="primary"
          (click)="sendMessage()"
          [disabled]="!messageInput().trim() || chatStore.isLoading() || !wsService.isConnected()"
          class="w-10 h-10 min-w-0 rounded-lg flex items-center justify-center flex-shrink-0"
        >
          <mat-icon>send</mat-icon>
        </button>
      </div>

      @if (isConnecting()) {
        <div class="text-xs text-muted-foreground mt-2 text-center">Connecting to server...</div>
      } @else if (!wsService.isConnected()) {
        <div class="text-xs text-warning mt-2 text-center">Not connected. Messages will be sent via HTTP.</div>
      }
    </div>
  </div>
</main>

# ═══════════════════════════════════════════════════════════
# MyLittlePrice - Production Configuration
# ═══════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────
# 🌐 Server Configuration
# ─────────────────────────────────────────────────────────────
PORT=8080
ENV=production

# ─────────────────────────────────────────────────────────────
# 📦 Redis Cache
# ─────────────────────────────────────────────────────────────
REDIS_URL=localhost:6379
REDIS_PASSWORD=
REDIS_DB=0

# ─────────────────────────────────────────────────────────────
# 🎯 Session Configuration
# ─────────────────────────────────────────────────────────────

# Session lifetime (seconds) - 86400 = 24 hours
SESSION_TTL=86400

# Maximum messages per session (spam protection)
MAX_MESSAGES_PER_SESSION=8

# Maximum product searches per session
# After each search, chat is blocked until "New Search"
# Recommended: 3 (balance between UX and costs)
MAX_SEARCHES_PER_SESSION=3

# ─────────────────────────────────────────────────────────────
# 🤖 API Keys
# ─────────────────────────────────────────────────────────────

# Gemini API Keys (comma-separated for rotation)
# Get from: https://makersuite.google.com/app/apikey
GEMINI_API_KEYS=AIzaSyBmlbvdPnmpQQV8rrCkPahMZLdEycK8830

# SERP API Keys (comma-separated for rotation)
# Get from: https://serpapi.com/
SERP_API_KEYS=10f08f3639a72a7bbf102195981444376f7b1d044bcf40a6ef0f716d16422603

# ─────────────────────────────────────────────────────────────
# 🧠 Gemini AI Configuration
# ─────────────────────────────────────────────────────────────

# Gemini model (recommended: gemini-2.5-flash for speed)
GEMINI_MODEL=gemini-2.5-flash-preview-09-2025

# Temperature (0.0-1.0, recommended: 0.7)
# Lower = more predictable, Higher = more creative
GEMINI_TEMPERATURE=0.7

# Max output tokens
# 1100 = optimal for dialogue (short answers, cheaper)
# 5000 = for long explanations (more expensive)
GEMINI_MAX_OUTPUT_TOKENS=5000

# ─────────────────────────────────────────────────────────────
# 🔍 Smart Grounding Configuration
# ─────────────────────────────────────────────────────────────

# Enable grounding (Google Search) globally
GEMINI_USE_GROUNDING=true

# Grounding usage mode:
# - conservative: Minimal usage (~10-20% of requests)
# - balanced: Optimal balance (~30-40% of requests) [RECOMMENDED]
# - aggressive: Maximum usage (~60-80% of requests)
GEMINI_GROUNDING_MODE=balanced

# Minimum words in query to detect specific product
# conservative: 3, balanced: 2, aggressive: 1
GEMINI_GROUNDING_MIN_WORDS=2

# ─────────────────────────────────────────────────────────────
# 🎯 Grounding Strategy Thresholds (Advanced)
# ─────────────────────────────────────────────────────────────

# Brand-only query detection confidence (0.0-1.0)
GEMINI_BRAND_QUERY_CONFIDENCE=0.95

# Grounding decision weights (should sum to ~1.0)
GEMINI_GROUNDING_WEIGHT_FRESH_INFO=0.3
GEMINI_GROUNDING_WEIGHT_SPECIFIC_PRODUCT=0.35
GEMINI_GROUNDING_WEIGHT_DIALOGUE_DRIFT=0.2
GEMINI_GROUNDING_WEIGHT_ELECTRONICS=0.15

# Grounding decision threshold (0.0-1.0)
GEMINI_GROUNDING_DECISION_THRESHOLD=0.5

# Brand query settings
GEMINI_BRAND_QUERY_MAX_WORDS=3
GEMINI_BRAND_SIMILARITY_THRESHOLD=0.65

# Dialogue drift detection
GEMINI_DIALOGUE_HISTORY_WINDOW=4
GEMINI_DIALOGUE_DRIFT_THRESHOLD=0.4
GEMINI_DRIFT_SCORE_BONUS=0.8

# Category similarity thresholds
GEMINI_ELECTRONICS_THRESHOLD_HIGH=0.7
GEMINI_ELECTRONICS_SCORE_HIGH=0.9
GEMINI_CATEGORY_SIMILARITY_THRESHOLD=0.6
GEMINI_CATEGORY_SCORE=0.5

# ─────────────────────────────────────────────────────────────
# 🌐 Translation Settings
# ─────────────────────────────────────────────────────────────

# Temperature for query translation (0.0-1.0, lower = more deterministic)
GEMINI_TRANSLATION_TEMPERATURE=0.3

# Max tokens for translation
GEMINI_TRANSLATION_MAX_TOKENS=100

# ─────────────────────────────────────────────────────────────
# 🧬 Embedding Settings
# ─────────────────────────────────────────────────────────────

# Gemini embedding model
GEMINI_EMBEDDING_MODEL=text-embedding-004

# Category detection threshold (0.0-1.0)
EMBEDDING_CATEGORY_DETECTION_THRESHOLD=0.6

# Query embedding cache TTL (seconds) - 86400 = 24 hours
CACHE_QUERY_EMBEDDING_TTL=86400

# ─────────────────────────────────────────────────────────────
# 🔍 SERP Relevance Thresholds
# ─────────────────────────────────────────────────────────────

# Relevance thresholds for different search types (0.0-1.0)
SERP_THRESHOLD_EXACT=0.4
SERP_THRESHOLD_PARAMETERS=0.2
SERP_THRESHOLD_CATEGORY=0.1

# Number of top results to log
SERP_LOG_TOP_RESULTS_COUNT=5

# Minimum results to return when none above threshold
SERP_FALLBACK_MIN_RESULTS=3

# ─────────────────────────────────────────────────────────────
# 📊 SERP Scoring Weights
# ─────────────────────────────────────────────────────────────

# Scoring bonuses (0.0-1.0)
SERP_SCORE_PHRASE_MATCH=1.0
SERP_SCORE_ALL_WORDS=0.6
SERP_SCORE_PARTIAL_WORDS=0.5
SERP_SCORE_WORD_ORDER_WEIGHT=0.2
SERP_SCORE_BRAND_MATCH=0.3
SERP_SCORE_MODEL_MATCH=0.3

# Minimum word/model number length
SERP_MIN_WORD_LENGTH=2
SERP_MODEL_NUMBER_MIN_LENGTH=2

# ─────────────────────────────────────────────────────────────
# 🎯 SERP Max Products per Search Type
# ─────────────────────────────────────────────────────────────

SERP_MAX_PRODUCTS_EXACT=3
SERP_MAX_PRODUCTS_PARAMETERS=6
SERP_MAX_PRODUCTS_CATEGORY=8
SERP_MAX_PRODUCTS_DEFAULT=6

# ─────────────────────────────────────────────────────────────
# 🌍 Default Values
# ─────────────────────────────────────────────────────────────

DEFAULT_COUNTRY=CH
DEFAULT_LANGUAGE=en

# ─────────────────────────────────────────────────────────────
# 💾 Cache TTL Configuration
# ─────────────────────────────────────────────────────────────

# Gemini responses cache (seconds) - 3600 = 1 hour
CACHE_GEMINI_TTL=3600

# SERP search results cache (seconds) - 86400 = 24 hours
CACHE_SERP_TTL=86400

# Product details cache (seconds) - 43200 = 12 hours
CACHE_IMMERSIVE_TTL=43200

# ─────────────────────────────────────────────────────────────
# 🚦 Rate Limiting
# ─────────────────────────────────────────────────────────────

RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=60

# ─────────────────────────────────────────────────────────────
# 🌍 CORS
# ─────────────────────────────────────────────────────────────

# Allowed origins (comma-separated)
CORS_ORIGINS=http://localhost:3000,http://localhost:3001

# ─────────────────────────────────────────────────────────────
# 📝 Logging
# ─────────────────────────────────────────────────────────────

# Log level: debug, info, warn, error
LOG_LEVEL=info

# ═══════════════════════════════════════════════════════════
# 📊 CONFIGURATION PRESETS
# ═══════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────
# 💰 ECONOMICAL MODE (minimal costs)
# ─────────────────────────────────────────────────────────────
# GEMINI_GROUNDING_MODE=conservative
# GEMINI_GROUNDING_MIN_WORDS=3
# GEMINI_MAX_OUTPUT_TOKENS=800
# MAX_SEARCHES_PER_SESSION=2
# SESSION_TTL=43200

# ─────────────────────────────────────────────────────────────
# ⚖️ BALANCED MODE (RECOMMENDED) ✅
# ─────────────────────────────────────────────────────────────
# GEMINI_GROUNDING_MODE=balanced
# GEMINI_GROUNDING_MIN_WORDS=2
# GEMINI_MAX_OUTPUT_TOKENS=1100
# MAX_SEARCHES_PER_SESSION=3
# SESSION_TTL=86400

# ─────────────────────────────────────────────────────────────
# 🎯 ACCURATE MODE (maximum freshness)
# ─────────────────────────────────────────────────────────────
# GEMINI_GROUNDING_MODE=aggressive
# GEMINI_GROUNDING_MIN_WORDS=1
# GEMINI_MAX_OUTPUT_TOKENS=1500
# MAX_SEARCHES_PER_SESSION=5